{% extends 'base.html' %}

{% block title %} {{ title_action }} {% endblock %}

{% block content %}
    <h1 class="text-center"> {{ title_action }} </h1>
    <form id="photoForm" method="post">
        {% csrf_token %}
        <video id="cameraFeed" width="340" height="300" autoplay></video>

        <canvas id="photoCanvas" width="640" height="480" style="display:none;"></canvas>
        <input type="hidden" name="photo" id="photoInput" >
        <div class="row">
            <button type="button" id="captureButton" class="btn btn-success col-4 ms-2">Фото</button>
            <button type="submit" class="btn btn-success col-4 ms-auto me-3">Отправить</button>
        </div>

    </form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const cameraFeed = document.getElementById('cameraFeed');
        const captureButton = document.getElementById('captureButton');
        const photoCanvas = document.getElementById('photoCanvas');
        const photoInput = document.getElementById('photoInput');

        // Получение доступа к камере
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function (stream) {
                cameraFeed.srcObject = stream;
            })
            .catch(function (error) {
                console.error('Ошибка при доступе к камере:', error);
            });

        // Функция для захвата фотографии
        captureButton.addEventListener('click', function () {
            const context = photoCanvas.getContext('2d');
            context.drawImage(cameraFeed, 0, 0, photoCanvas.width, photoCanvas.height);
            const photoDataUrl = photoCanvas.toDataURL('image/jpeg');
            photoInput.value = photoDataUrl;
            // Дополнительные действия, например, предварительный просмотр или другая обработка
        });
    });
</script>
{% endblock %}